const template=document.createElement("template");template.innerHTML='\n    <style>:host{box-sizing:border-box;display:block;position:relative}.autocomplete-container{box-sizing:border-box;cursor:text;background-color:#fff;border:1px solid #ccc;border-radius:5px;flex-wrap:wrap;align-items:center;min-height:40px;padding:10px 30px 10px 10px;display:flex;position:relative;box-shadow:0 2px 5px #0000001a}.selected-labels-container{box-sizing:border-box;flex-wrap:wrap;gap:5px;padding-right:5px;display:flex}.selected-label{color:#fff;white-space:nowrap;box-sizing:border-box;background-color:#007bff;border-radius:15px;align-items:center;height:fit-content;margin-bottom:5px;margin-right:5px;padding:5px 10px;font-size:.9em;display:inline-flex}.remove-label-btn{cursor:pointer;background-color:#fff3;border-radius:50%;justify-content:center;align-items:center;margin-left:8px;padding:0 3px;font-size:1.1em;font-weight:700;line-height:1;transition:background-color .2s;display:inline-flex}.remove-label-btn:hover{background-color:#fff6}.autocomplete-input{box-sizing:border-box;background-color:#f5f5f5;border:none;border-radius:3px;outline:none;flex-grow:1;align-self:center;min-width:150px;height:fit-content;margin-bottom:5px;padding:7px 8px;font-size:1em}.suggestions-list{z-index:1000;box-sizing:border-box;background-color:#fff;border:1px solid #ccc;border-top:none;border-radius:0 0 5px 5px;max-height:200px;margin:0;padding:0;list-style:none;display:none;position:absolute;top:calc(100% - 1px);left:0;right:0;overflow-y:auto;box-shadow:0 4px 8px #0000001a}.suggestion-item{cursor:pointer;box-sizing:border-box;white-space:nowrap;text-overflow:ellipsis;border-bottom:1px solid #eee;padding:10px;overflow:hidden}.suggestion-item:last-child{border-bottom:none}.suggestion-item:hover,.suggestion-item.highlighted{background-color:#f0f0f0}.suggestion-item.add-new-item{color:#0056b3;font-style:italic;font-weight:700}.suggestion-item.add-new-item:before{content:"+ ";color:#28a745;font-weight:700}.suggestion-item.add-new-item:hover,.suggestion-item.add-new-item.highlighted{color:#003d80;background-color:#e7f2ff}.clear-all-btn{color:#aaa;cursor:pointer;z-index:5;box-sizing:border-box;background-color:#0000;border-radius:3px;padding:2px 4px;font-size:1.4em;font-weight:700;line-height:1;display:none;position:absolute;top:8px;right:8px}.clear-all-btn:hover{color:#333;background-color:#eee}</style>\n    <div class="autocomplete-container" part="container">\n        <div class="selected-labels-container" part="labels-container">\n            </div>\n        <input type="text" class="autocomplete-input" part="input" autocomplete="off" role="combobox" aria-expanded="false" aria-haspopup="listbox"/>\n        <span class="clear-all-btn" part="clear-button" role="button" aria-label="Clear all selections" title="Clear all selections">&times;</span>\n        <ul class="suggestions-list" part="suggestions-list" role="listbox">\n            </ul>\n    </div>\n';class MultiSelectAutocompleteComponent extends HTMLElement{static componentStylesClass="autocomplete-container";static labelsClass="selected-labels-container";static labelClass="selected-label";static removeClass="remove-label-btn";static clearClass="clear-all-btn";static inputClass="autocomplete-input";static suggestionsListClass="suggestions-list";static suggestionItemClass="suggestion-item";static highlightClass="highlighted";static addNewItemClass="add-new-item";static get observedAttributes(){return["placeholder","max-suggestions","suggestions","selected"]}constructor(){super(),this.allSuggestionsData=[],this.selectedItems=[],this.selectedItemsSet=new Set,this.currentFilteredSuggestions=[],this.highlightedIndex=-1,this._maxSuggestions=10,this._placeholder="Type to search...",this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(template.content.cloneNode(!0)),this._wrapperElement=this.shadowRoot.querySelector(`.${MultiSelectAutocompleteComponent.componentStylesClass}`),this._inputElement=this.shadowRoot.querySelector(`.${MultiSelectAutocompleteComponent.inputClass}`),this._selectedLabelsContainer=this.shadowRoot.querySelector(`.${MultiSelectAutocompleteComponent.labelsClass}`),this._clearAllButtonElement=this.shadowRoot.querySelector(`.${MultiSelectAutocompleteComponent.clearClass}`),this._suggestionsListElement=this.shadowRoot.querySelector(`.${MultiSelectAutocompleteComponent.suggestionsListClass}`),this._suggestionsListElement.id=`msa-suggestions-${crypto.randomUUID()}`,this._inputElement.setAttribute("aria-owns",this._suggestionsListElement.id),this._bindEventHandlers()}connectedCallback(){console.log("[MultiSelectAutocompleteComponent] Connected"),this._updateConfigFromAttributes(),this._addEventListeners(),this._renderSelectedLabels(),this._inputElement.placeholder=this._placeholder}disconnectedCallback(){console.log("[MultiSelectAutocompleteComponent] Disconnected"),this._removeEventListeners(),this._wrapperElement=null,this._inputElement=null}attributeChangedCallback(e,t,s){t!==s&&(this._updateConfigFromAttributes(),"selected"!==e&&"suggestions"!==e||(this._renderSelectedLabels(),this._hideSuggestions()),"placeholder"===e&&(this._inputElement.placeholder=this._placeholder))}_bindEventHandlers(){this.boundHandleInput=this._handleInput.bind(this),this.boundHandleKeyDown=this._handleKeyDown.bind(this),this.boundHandleInputClick=this._handleInputClick.bind(this),this.boundHandleDocumentClick=this._handleDocumentClick.bind(this),this.boundHandleContainerClick=this._handleContainerClick.bind(this),this.boundHandleClearAllClick=this._handleClearAllClick.bind(this),this.boundHandleLabelContainerClick=this._handleLabelContainerClick.bind(this)}_updateConfigFromAttributes(){this._placeholder=this.getAttribute("placeholder")||"Type to search...";const e=this.getAttribute("max-suggestions");this._maxSuggestions=e?parseInt(e,10):10,(isNaN(this._maxSuggestions)||this._maxSuggestions<=0)&&(this._maxSuggestions=10);try{const e=this.getAttribute("suggestions");this.allSuggestionsData=e?this._processStringArray(JSON.parse(e)):[]}catch(e){console.error('[MultiSelectAutocompleteComponent] Failed to parse "suggestions" attribute JSON.',e),this.allSuggestionsData=[]}try{const e=this.getAttribute("selected");null!==e&&(this.selectedItems=this._processStringArray(JSON.parse(e)),this.selectedItemsSet=new Set(this.selectedItems.map((e=>e.toLowerCase()))))}catch(e){console.error('[MultiSelectAutocompleteComponent] Failed to parse "selected" attribute JSON.',e),this.selectedItems||(this.selectedItems=[],this.selectedItemsSet=new Set)}}_processStringArray(e){return Array.isArray(e)?[...new Set(e.filter((e=>"string"==typeof e)).map((e=>e.trim())).filter((e=>e.length>0)))]:[]}_addEventListeners(){this._inputElement.addEventListener("input",this.boundHandleInput),this._inputElement.addEventListener("keydown",this.boundHandleKeyDown),this._inputElement.addEventListener("click",this.boundHandleInputClick),this._selectedLabelsContainer.addEventListener("click",this.boundHandleLabelContainerClick),this._clearAllButtonElement.addEventListener("click",this.boundHandleClearAllClick),this._wrapperElement.addEventListener("click",this.boundHandleContainerClick),document.addEventListener("click",this.boundHandleDocumentClick,!0)}_removeEventListeners(){this._inputElement?.removeEventListener("input",this.boundHandleInput),this._inputElement?.removeEventListener("keydown",this.boundHandleKeyDown),this._inputElement?.removeEventListener("click",this.boundHandleInputClick),this._selectedLabelsContainer?.removeEventListener("click",this.boundHandleLabelContainerClick),this._clearAllButtonElement?.removeEventListener("click",this.boundHandleClearAllClick),this._wrapperElement?.removeEventListener("click",this.boundHandleContainerClick),document.removeEventListener("click",this.boundHandleDocumentClick,!0)}_handleInput(){this._displaySuggestions()}_handleKeyDown(e){const t="block"===this._suggestionsListElement.style.display,s=t?this._suggestionsListElement.querySelectorAll(`.${MultiSelectAutocompleteComponent.suggestionItemClass}`):[],i=s.length;let n=!1;switch(e.key){case"ArrowDown":n=!0,!t&&this._inputElement.value.trim().length>0?this._displaySuggestions():t&&i>0&&(this.highlightedIndex=(this.highlightedIndex+1)%i,this._updateHighlight());break;case"ArrowUp":n=!0,t&&i>0&&(this.highlightedIndex=(this.highlightedIndex-1+i)%i,this._updateHighlight());break;case" ":if(t&&this.highlightedIndex>-1&&i>0){n=!0;const e=s[this.highlightedIndex];if(e){const t=e.dataset.addNewValue||e.textContent;t&&this.addItem(t)}}break;case"Enter":n=!0;let e=null;if(t&&this.highlightedIndex>-1&&s[this.highlightedIndex]){const t=s[this.highlightedIndex];e=t.dataset.addNewValue||t.textContent}else{const t=this._inputElement.value.trim();t.length>0&&(e=t)}e&&this.addItem(e),this._inputElement.value="",this._hideSuggestions();break;case"Escape":t&&(n=!0,this._hideSuggestions());break;default:t&&(this.highlightedIndex=-1,this._updateHighlight(!1))}n&&e.preventDefault()}_handleInputClick(e){e.stopPropagation(),this._inputElement.value.trim().length>0&&"none"===this._suggestionsListElement.style.display&&this._displaySuggestions()}_handleLabelContainerClick(e){if(e.target.classList.contains(MultiSelectAutocompleteComponent.removeClass)){e.stopPropagation();const t=e.target.closest("."+MultiSelectAutocompleteComponent.labelClass),s=t?.dataset.value;s&&(this.removeItem(s),this._inputElement.focus())}}_handleClearAllClick(e){e.stopPropagation(),this.clearSelection(),this._inputElement.focus()}_handleContainerClick(e){const t=e.target;t!==this._wrapperElement&&t!==this._selectedLabelsContainer||t.closest("."+MultiSelectAutocompleteComponent.removeClass)||t===this._clearAllButtonElement||t===this._inputElement||t.closest("."+MultiSelectAutocompleteComponent.suggestionItemClass)||this._inputElement.focus()}_handleDocumentClick(e){this.contains(e.target)||this._hideSuggestions()}_renderSelectedLabels(){const e=document.createDocumentFragment();this.selectedItems.forEach((t=>{const s=document.createElement("span");s.className=MultiSelectAutocompleteComponent.labelClass,s.textContent=t,s.dataset.value=t,s.setAttribute("part","selected-label");const i=document.createElement("span");i.className=MultiSelectAutocompleteComponent.removeClass,i.innerHTML="&times;",i.title=`Remove ${t}`,i.setAttribute("role","button"),i.setAttribute("aria-label",`Remove ${t}`),i.setAttribute("part","remove-button"),i.tabIndex=-1,s.appendChild(i),e.appendChild(s)})),this._selectedLabelsContainer.innerHTML="",this._selectedLabelsContainer.appendChild(e),this._clearAllButtonElement.style.display=this.selectedItems.length>0?"inline-block":"none"}_displaySuggestions(){const e=this._inputElement.value.trim(),t=e.toLowerCase();if(this._suggestionsListElement.innerHTML="",this.currentFilteredSuggestions=[],0===t.length)return void this._hideSuggestions();this.currentFilteredSuggestions=this.allSuggestionsData.filter((e=>!this.selectedItemsSet.has(e.toLowerCase())&&e.toLowerCase().includes(t)));let s=!1;if(e.length>0){const e=this.allSuggestionsData.some((e=>e.toLowerCase()===t)),i=this.selectedItemsSet.has(t);s=!e&&!i}const i=document.createDocumentFragment();if(s){const t=this._createSuggestionLi(`Add "${e}"`,`${MultiSelectAutocompleteComponent.suggestionItemClass} ${MultiSelectAutocompleteComponent.addNewItemClass}`,`${this._suggestionsListElement.id}-addnew`);t.dataset.addNewValue=e,t.setAttribute("part","suggestion-item add-new-item"),t.addEventListener("click",(t=>{t.stopPropagation(),this.addItem(e)})),i.appendChild(t)}this.currentFilteredSuggestions.slice(0,this._maxSuggestions).forEach(((e,t)=>{const s=this._createSuggestionLi(e,MultiSelectAutocompleteComponent.suggestionItemClass,`${this._suggestionsListElement.id}-item-${t}`);s.setAttribute("part","suggestion-item"),s.addEventListener("click",(t=>{t.stopPropagation(),this.addItem(e)})),i.appendChild(s)})),i.hasChildNodes()?(this._suggestionsListElement.appendChild(i),this.highlightedIndex=-1,this._updateHighlight(!1),this._suggestionsListElement.style.display="block",this._inputElement.setAttribute("aria-expanded","true")):this._hideSuggestions()}_createSuggestionLi(e,t,s){const i=document.createElement("li");return i.className=t,i.textContent=e,i.setAttribute("role","option"),i.id=s,i}_hideSuggestions(){"none"!==this._suggestionsListElement.style.display&&(this._suggestionsListElement.style.display="none",this._inputElement.setAttribute("aria-expanded","false"),this._inputElement.removeAttribute("aria-activedescendant"),this.highlightedIndex=-1)}_updateHighlight(e=!0){const t=this._suggestionsListElement.querySelectorAll(`.${MultiSelectAutocompleteComponent.suggestionItemClass}`);let s=null;t.forEach(((t,i)=>{const n=i===this.highlightedIndex;t.classList.toggle(MultiSelectAutocompleteComponent.highlightClass,n),n?(t.setAttribute("aria-selected","true"),s=t.id,e&&t.scrollIntoView({block:"nearest"})):t.removeAttribute("aria-selected")})),s?this._inputElement.setAttribute("aria-activedescendant",s):this._inputElement.removeAttribute("aria-activedescendant")}addItem(e){const t=e?.trim();if(!t)return!1;const s=t.toLowerCase();return this.selectedItemsSet.has(s)?(this._inputElement.focus(),!1):(this.selectedItems.push(t),this.selectedItemsSet.add(s),this._renderSelectedLabels(),this._displaySuggestions(),this.dispatchEvent(new CustomEvent("add",{bubbles:!0,composed:!0,detail:{item:t}})),this._inputElement.focus(),!0)}removeItem(e){if(!e)return!1;const t=e.toLowerCase();return!!this.selectedItemsSet.has(t)&&(this.selectedItems=this.selectedItems.filter((e=>e.toLowerCase()!==t)),this.selectedItemsSet.delete(t),this._renderSelectedLabels(),this._displaySuggestions(),this.dispatchEvent(new CustomEvent("remove",{bubbles:!0,composed:!0,detail:{item:e}})),!0)}clearSelection(){if(0===this.selectedItems.length)return;const e=[...this.selectedItems];this.selectedItems=[],this.selectedItemsSet.clear(),this._renderSelectedLabels(),this._displaySuggestions(),this.dispatchEvent(new CustomEvent("clearall",{bubbles:!0,composed:!0,detail:{removedItems:e}}))}getSelectedItems(){return[...this.selectedItems]}setSuggestions(e){this.allSuggestionsData=this._processStringArray(e),this._displaySuggestions()}setSelected(e){this.selectedItems=this._processStringArray(e),this.selectedItemsSet=new Set(this.selectedItems.map((e=>e.toLowerCase()))),this._renderSelectedLabels(),this._displaySuggestions()}}window.customElements.get("multi-select-autocomplete")||window.customElements.define("multi-select-autocomplete",MultiSelectAutocompleteComponent);